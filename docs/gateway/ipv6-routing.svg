<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: #f0f0f0; stroke: #333; stroke-width: 2; }
      .internet { fill: #e6f3ff; stroke: #0066cc; stroke-width: 2; }
      .router { fill: #fff2e6; stroke: #ff6600; stroke-width: 2; }
      .rpi { fill: #e6ffe6; stroke: #00cc00; stroke-width: 2; }
      .device { fill: #ffe6f0; stroke: #cc0066; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #333; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #333; }
      .ip { font-family: monospace; font-size: 11px; fill: #666; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .direct-arrow { stroke: #00cc00; stroke-width: 3; fill: none; marker-end: url(#greenarrow); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="greenarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00cc00" />
    </marker>
  </defs>

  <!-- Internet -->
  <ellipse cx="70" cy="200" rx="50" ry="80" class="internet"/>
  <text x="70" y="185" text-anchor="middle" class="title">Internet</text>
  <text x="70" y="205" text-anchor="middle" class="text">External</text>
  <text x="70" y="220" text-anchor="middle" class="text">Users</text>

  <!-- Router -->
  <rect x="150" y="120" width="180" height="160" class="router" rx="5"/>
  <text x="240" y="140" text-anchor="middle" class="title">Router</text>
  
  <!-- Router - Left side (WAN) -->
  <rect x="160" y="155" width="70" height="55" class="box" rx="3"/>
  <text x="195" y="170" text-anchor="middle" class="text">Public IPs</text>
  <text x="195" y="185" text-anchor="middle" class="ip">IPv4: x.x.x.x</text>
  <text x="195" y="198" text-anchor="middle" class="ip">IPv6: 2001:db8:1234::1</text>
  
  <text x="195" y="225" text-anchor="middle" class="text">Ports 53,80,443</text>
  <text x="195" y="238" text-anchor="middle" class="text">→ Gateway</text>
  
  <!-- Router - Management UI -->
  <rect x="240" y="155" width="80" height="40" class="box" rx="3"/>
  <text x="280" y="170" text-anchor="middle" class="text">Management</text>
  <text x="280" y="183" text-anchor="middle" class="text">UI</text>
  
  <!-- Router - Right side (Problem) -->
  <rect x="240" y="205" width="80" height="40" class="box" rx="3"/>
  <text x="280" y="220" text-anchor="middle" class="text">IPv6 Direct</text>
  <text x="280" y="233" text-anchor="middle" class="text">→ Mgmt UI</text>
  <text x="280" y="255" text-anchor="middle" class="text" fill="red">(Problem!)</text>

  <!-- Raspberry Pi -->
  <rect x="370" y="120" width="180" height="160" class="rpi" rx="5"/>
  <text x="460" y="140" text-anchor="middle" class="title">Raspberry Pi</text>
  
  <!-- Gateway -->
  <rect x="380" y="155" width="70" height="55" class="box" rx="3"/>
  <text x="415" y="170" text-anchor="middle" class="text">Gateway</text>
  <text x="415" y="185" text-anchor="middle" class="ip">IPv6: 2001:db8:1234::2</text>
  <text x="415" y="225" text-anchor="middle" class="text">Ports</text>
  <text x="415" y="238" text-anchor="middle" class="text">53,80,443</text>
  
  <!-- Home Assistant -->
  <rect x="460" y="155" width="80" height="55" class="box" rx="3"/>
  <text x="500" y="170" text-anchor="middle" class="text">Home</text>
  <text x="500" y="183" text-anchor="middle" class="text">Assistant</text>
  <text x="500" y="200" text-anchor="middle" class="text">Port 8123</text>

  <!-- Local PC/Mac -->
  <rect x="590" y="160" width="100" height="80" class="device" rx="5"/>
  <text x="640" y="180" text-anchor="middle" class="title">Local PC/Mac</text>
  <text x="640" y="200" text-anchor="middle" class="text">Direct IPv6</text>
  <text x="640" y="215" text-anchor="middle" class="text">Connection to</text>
  <text x="640" y="230" text-anchor="middle" class="ip">2001:db8:1234::2</text>

  <!-- Arrows -->
  <!-- Internet to Router -->
  <line x1="120" y1="200" x2="150" y2="185" class="arrow"/>
  
  <!-- Router to Gateway (port forwarding) -->
  <line x1="330" y1="175" x2="370" y2="175" class="arrow"/>
  
  <!-- Gateway to Home Assistant -->
  <line x1="450" y1="182" x2="460" y2="182" class="arrow"/>
  
  <!-- Direct connection from PC to Gateway (IPv6) -->
  <path d="M 590 200 Q 520 120 450 182" class="direct-arrow"/>
  <text x="520" y="110" text-anchor="middle" class="text" fill="#00cc00">Direct IPv6 to Gateway</text>
  <text x="520" y="125" text-anchor="middle" class="text" fill="#00cc00">(bypasses router mgmt UI)</text>

  <!-- Legend -->
  <rect x="20" y="20" width="200" height="60" fill="white" stroke="#ccc" rx="3"/>
  <text x="30" y="35" class="title">IPv6 Routing Solution</text>
  <line x1="30" y1="45" x2="50" y2="45" class="arrow"/>
  <text x="55" y="49" class="text">Internet traffic</text>
  <line x1="30" y1="60" x2="50" y2="60" class="direct-arrow"/>
  <text x="55" y="64" class="text">Local IPv6 direct</text>
</svg>