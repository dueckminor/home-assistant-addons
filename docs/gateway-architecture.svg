<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Define gradient styles -->
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4a90e2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#357abd;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7ed321;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#5ba617;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f5a623;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d18910;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#d0021b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#a30115;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    Home Assistant Gateway Architecture
  </text>

  <!-- Internet Cloud -->
  <ellipse cx="150" cy="80" rx="80" ry="30" fill="url(#blueGrad)" stroke="#2c5aa0" stroke-width="2"/>
  <text x="150" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Internet</text>

  <!-- External Services -->
  <rect x="50" y="120" width="200" height="80" rx="5" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
  <text x="150" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">External IP Sources</text>
  <text x="150" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">DNS: akifz7to9jutsiwd.myfritz.net</text>
  <text x="150" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">IPv6: ha.rh94.dueckminor.de</text>
  <text x="150" y="192" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Domain: rh94-dev.dueckminor.de</text>

  <!-- Gateway Main Container -->
  <rect x="350" y="50" width="500" height="580" rx="10" fill="#fff" stroke="#333" stroke-width="3"/>
  <text x="600" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">Home Assistant Gateway</text>

  <!-- DNS Server -->
  <rect x="370" y="90" width="150" height="80" rx="5" fill="url(#greenGrad)" stroke="#4a7c0d" stroke-width="2"/>
  <text x="445" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">DNS Server</text>
  <text x="445" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Port: 53</text>
  <text x="445" y="147" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">External IP Resolution</text>
  <text x="445" y="162" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Domain Management</text>

  <!-- ACME Client -->
  <rect x="540" y="90" width="120" height="80" rx="5" fill="url(#orangeGrad)" stroke="#a66908" stroke-width="2"/>
  <text x="600" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">ACME Client</text>
  <text x="600" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Let's Encrypt</text>
  <text x="600" y="147" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">SSL Certificates</text>
  <text x="600" y="162" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Wildcard Certs</text>

  <!-- PKI Management -->
  <rect x="680" y="90" width="150" height="80" rx="5" fill="url(#redGrad)" stroke="#7a0d10" stroke-width="2"/>
  <text x="755" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">PKI Management</text>
  <text x="755" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Certificate Storage</text>
  <text x="755" y="147" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">TLS Configuration</text>
  <text x="755" y="162" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Auto-renewal</text>

  <!-- HTTP Server -->
  <rect x="370" y="190" width="200" height="60" rx="5" fill="#e9ecef" stroke="#6c757d" stroke-width="2"/>
  <text x="470" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">HTTP Server</text>
  <text x="470" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Port: 80 → Redirect to HTTPS</text>

  <!-- HTTPS/TLS Proxy -->
  <rect x="600" y="190" width="230" height="60" rx="5" fill="url(#blueGrad)" stroke="#2c5aa0" stroke-width="2"/>
  <text x="715" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">HTTPS/TLS Proxy</text>
  <text x="715" y="232" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Port: 443 - SSL Termination</text>

  <!-- Auth Server -->
  <rect x="370" y="280" width="200" height="80" rx="5" fill="#6f42c1" stroke="#4a2c7a" stroke-width="2"/>
  <text x="470" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Auth Server</text>
  <text x="470" y="322" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">auth.rh94-dev.dueckminor.de</text>
  <text x="470" y="337" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">OAuth2 / Session Management</text>
  <text x="470" y="352" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Web UI (/usr/local/bin/dist/)</text>

  <!-- Reverse Proxy Targets -->
  <rect x="600" y="280" width="230" height="140" rx="5" fill="#f8f9fa" stroke="#6c757d" stroke-width="2"/>
  <text x="715" y="305" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Reverse Proxy Targets</text>
  
  <!-- Target Services -->
  <rect x="620" y="320" width="190" height="30" rx="3" fill="#d4edda" stroke="#155724" stroke-width="1"/>
  <text x="715" y="339" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#155724">fritzbox.rh94-dev.dueckminor.de → https://192.168.0.1</text>
  
  <rect x="620" y="360" width="190" height="30" rx="3" fill="#cce5ff" stroke="#004085" stroke-width="1"/>
  <text x="715" y="379" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#004085">*.rh94-dev.dueckminor.de → Internal Services</text>
  
  <rect x="620" y="400" width="90" height="15" rx="2" fill="#fff3cd" stroke="#856404" stroke-width="1"/>
  <text x="665" y="411" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#856404">Auth Required</text>
  
  <rect x="720" y="400" width="90" height="15" rx="2" fill="#f8d7da" stroke="#721c24" stroke-width="1"/>
  <text x="765" y="411" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#721c24">Insecure Mode</text>

  <!-- Internal Network -->
  <rect x="370" y="450" width="460" height="160" rx="5" fill="#e8f5e8" stroke="#28a745" stroke-width="2"/>
  <text x="600" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#155724">Internal Network Services</text>
  
  <!-- Internal Services -->
  <rect x="390" y="490" width="120" height="50" rx="3" fill="#fff" stroke="#666" stroke-width="1"/>
  <text x="450" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Home Assistant</text>
  <text x="450" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">192.168.0.x</text>
  
  <rect x="530" y="490" width="120" height="50" rx="3" fill="#fff" stroke="#666" stroke-width="1"/>
  <text x="590" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">FritzBox</text>
  <text x="590" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">192.168.0.1</text>
  
  <rect x="670" y="490" width="120" height="50" rx="3" fill="#fff" stroke="#666" stroke-width="1"/>
  <text x="730" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Other Services</text>
  <text x="730" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">TCP/HTTP Proxies</text>

  <rect x="390" y="550" width="400" height="50" rx="3" fill="#fff" stroke="#666" stroke-width="1"/>
  <text x="590" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#333">Development Mode</text>
  <text x="590" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#666">*.domain → Dev targets (HTTP/HTTPS/DNS proxy)</text>

  <!-- Arrows -->
  <!-- Internet to Gateway -->
  <path d="M230 160 L350 200" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- DNS arrows -->
  <path d="M250 160 L370 130" stroke="#28a745" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- ACME arrows -->
  <path d="M230 100 L540 120" stroke="#f39c12" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Internal flow arrows -->
  <path d="M470 250 L470 280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <path d="M715 250 L715 280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <path d="M715 420 L600 450" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
    </marker>
  </defs>

  <!-- Legend -->
  <rect x="50" y="520" width="280" height="150" rx="5" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1"/>
  <text x="190" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Key Features</text>
  
  <circle cx="70" cy="555" r="5" fill="#7ed321"/>
  <text x="85" y="560" font-family="Arial, sans-serif" font-size="10" fill="#333">DNS Server with External IP Resolution</text>
  
  <circle cx="70" cy="575" r="5" fill="#f5a623"/>
  <text x="85" y="580" font-family="Arial, sans-serif" font-size="10" fill="#333">Automatic SSL Certificate Management</text>
  
  <circle cx="70" cy="595" r="5" fill="#4a90e2"/>
  <text x="85" y="600" font-family="Arial, sans-serif" font-size="10" fill="#333">TLS Proxy with SNI-based Routing</text>
  
  <circle cx="70" cy="615" r="5" fill="#6f42c1"/>
  <text x="85" y="620" font-family="Arial, sans-serif" font-size="10" fill="#333">OAuth2 Authentication Server</text>
  
  <circle cx="70" cy="635" r="5" fill="#28a745"/>
  <text x="85" y="640" font-family="Arial, sans-serif" font-size="10" fill="#333">Reverse Proxy to Internal Services</text>
  
  <circle cx="70" cy="655" r="5" fill="#dc3545"/>
  <text x="85" y="660" font-family="Arial, sans-serif" font-size="10" fill="#333">Development Mode Support</text>
</svg>